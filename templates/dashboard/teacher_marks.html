<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Bulk Marks Entry</title>

  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600&display=swap" rel="stylesheet">

  <style>
    body { font-family: "Poppins", sans-serif; background:#f5f7fb; margin:0; }
    .container-box{
      width:85%; margin:40px auto; background:white; padding:30px;
      border-radius:14px; box-shadow:0 6px 18px rgba(0,0,0,.08);
      animation:fadeUp .8s ease;
    }
    h2{margin:0;font-weight:600;color:#1B263B;}

    select,input{
      width:100%; padding:10px; margin-bottom:12px; border-radius:8px;
      border:2px solid #ddd; font-size:15px; transition:.3s;
    }
    select:focus,input:focus{
      border-color:#f4c430; box-shadow:0 0 6px rgba(244,196,48,.4);
      outline:none;
    }

    table{ width:100%; border-collapse:collapse; margin-top:20px; }
    th{
      background:#f4c430; padding:12px; font-size:15px; text-align:left;
    }
    td{ padding:10px; border-bottom:1px solid #eee; }
    tr:hover{ background:#fff8d3; }

    .btn-save{
      background:#2ea44f;color:white;padding:12px 22px;border-radius:8px;
      border:none;font-size:16px;margin-top:25px;cursor:pointer;transition:.3s;
    }
    .btn-save:hover{ background:#248f41; }

    .btn-back{
      background:#1B263B;color:white;padding:12px 22px;border-radius:8px;
      text-decoration:none;font-size:16px;margin-top:25px;margin-left:10px;
      transition:.3s;display:inline-block;
    }
    .btn-back:hover{ background:#31415c; }

    .top-input { display:flex; gap:20px; margin-top:15px; }

    @keyframes fadeUp{
      from{opacity:0;transform:translateY(25px);}
      to{opacity:1;transform:translateY(0);}
    }
  </style>
</head>

<body>

<div class="container-box">

  <h2>üìù Bulk Marks Entry</h2>
  <hr style="border-top:2px solid #f4c430;">

  {% with messages = get_flashed_messages(with_categories=true) %}
  {% if messages %}
    {% for category,msg in messages %}
      <div class="alert alert-{{category}}">{{msg}}</div>
    {% endfor %}
  {% endif %}
  {% endwith %}

  <!-- Subject + Class + Date -->
  <form method="POST">

    <div class="top-input">
      <div style="width:33%">
        <label><b>Subject:</b></label>
        <select name="subject" required>
          <option value="">-- Select --</option>
          <option>Maths</option><option>Science</option><option>English</option>
          <option>Hindi</option><option>Social science</option>
          <option>Gujarati</option>
        </select>
      </div>

      <div style="width:33%">
        <label><b>Select Class:</b></label>
        <select name="class" id="classSelect" required onchange="loadStudents()">
          <option value="">-- Select Class --</option>
          {% for s in students %}
            <option value="{{s.class_name}}">{{s.class_name}}</option>
          {% endfor %}
        </select>
      </div>

      <div style="width:33%">
        <label><b>Date:</b></label>
        <input type="date" name="date" required>
      </div>
    </div>

    <table id="studentsTable" style="display:none;">
      <thead>
        <tr>
          <th>Name</th><th>Enrollment</th><th>Status</th><th>Marks</th><th>Out Of</th>
        </tr>
      </thead>
      <tbody id="studentRows"></tbody>
    </table>

    <button type="submit" id="submitBtn" class="btn-save" style="display:none;">Save All Marks</button>
    <a href="/teacher/dashboard" class="btn-back">‚¨Ö Back</a>

  </form>

</div>

<script>
function loadStudents(){
  let cls = document.getElementById("classSelect").value;
  let table=document.getElementById("studentsTable");
  let submitBtn=document.getElementById("submitBtn");
  let tbody=document.getElementById("studentRows");

  tbody.innerHTML="";
  if(cls==""){ table.style.display="none"; submitBtn.style.display="none"; return;}

  let allStudents=[
    {% for student in students %}
      {id:"{{student.id}}",name:"{{student.name}}",enroll:"{{student.enrollment_no}}",cls:"{{student.class_name}}"},
    {% endfor %}
  ];

  allStudents.filter(s=>s.cls===cls).forEach(s=>{
    tbody.innerHTML+=`
    <tr>
      <td>${s.name}</td>
      <td>${s.enroll}</td>
      <td>
        <select name="status_${s.id}">
          <option value="Present">Present</option>
          <option value="Absent">Absent</option>
        </select>
      </td>
      <td><input type="number" name="score_${s.id}" placeholder="Marks"></td>
      <td><input type="number" name="outof_${s.id}" placeholder="Out Of"></td>
    </tr>`;
  });

  table.style.display="table"; submitBtn.style.display="inline-block";
}
</script>

</body>
</html>
